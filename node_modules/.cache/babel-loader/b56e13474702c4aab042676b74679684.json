{"ast":null,"code":"var promises = require(\"../promises\");\n\nvar sax = require(\"sax\");\n\nvar _ = require(\"underscore\");\n\nvar nodes = require(\"./nodes\");\n\nvar Element = nodes.Element;\nexports.readString = readString;\n\nfunction readString(xmlString, namespaceMap) {\n  namespaceMap = namespaceMap || {};\n  var finished = false;\n  var parser = sax.parser(true, {\n    xmlns: true,\n    position: false\n  });\n  var rootElement = {\n    children: []\n  };\n  var currentElement = rootElement;\n  var stack = [];\n  var deferred = promises.defer();\n\n  parser.onopentag = function (node) {\n    var attributes = mapObject(node.attributes, function (attribute) {\n      return attribute.value;\n    }, mapName);\n    var element = new Element(mapName(node), attributes);\n    currentElement.children.push(element);\n    stack.push(currentElement);\n    currentElement = element;\n  };\n\n  function mapName(node) {\n    if (node.uri) {\n      var mappedPrefix = namespaceMap[node.uri];\n      var prefix;\n\n      if (mappedPrefix) {\n        prefix = mappedPrefix + \":\";\n      } else {\n        prefix = \"{\" + node.uri + \"}\";\n      }\n\n      return prefix + node.local;\n    } else {\n      return node.local;\n    }\n  }\n\n  parser.onclosetag = function (node) {\n    currentElement = stack.pop();\n  };\n\n  parser.ontext = function (text) {\n    if (currentElement !== rootElement) {\n      currentElement.children.push(nodes.text(text));\n    }\n  };\n\n  parser.onend = function () {\n    if (!finished) {\n      finished = true;\n      deferred.resolve(rootElement.children[0]);\n    }\n  };\n\n  parser.onerror = function (error) {\n    if (!finished) {\n      finished = true;\n      deferred.reject(error);\n    }\n  };\n\n  parser.write(xmlString).close();\n  return deferred.promise;\n}\n\nfunction mapObject(input, valueFunc, keyFunc) {\n  return _.reduce(input, function (result, value, key) {\n    var mappedKey = keyFunc(value, key, input);\n    result[mappedKey] = valueFunc(value, key, input);\n    return result;\n  }, {});\n}","map":{"version":3,"names":["promises","require","sax","_","nodes","Element","exports","readString","xmlString","namespaceMap","finished","parser","xmlns","position","rootElement","children","currentElement","stack","deferred","defer","onopentag","node","attributes","mapObject","attribute","value","mapName","element","push","uri","mappedPrefix","prefix","local","onclosetag","pop","ontext","text","onend","resolve","onerror","error","reject","write","close","promise","input","valueFunc","keyFunc","reduce","result","key","mappedKey"],"sources":["E:/react-projects/new project/2022/converter/converter/node_modules/mammoth/lib/xml/reader.js"],"sourcesContent":["var promises = require(\"../promises\");\nvar sax = require(\"sax\");\nvar _ = require(\"underscore\");\n\nvar nodes = require(\"./nodes\");\nvar Element = nodes.Element;\n\nexports.readString = readString;\n\nfunction readString(xmlString, namespaceMap) {\n    namespaceMap = namespaceMap || {};\n    \n    var finished = false;\n    var parser = sax.parser(true, {xmlns: true, position: false});\n    \n    var rootElement = {children: []};\n    var currentElement = rootElement;\n    var stack = [];\n    \n    var deferred = promises.defer();\n    \n    parser.onopentag = function(node) {\n        var attributes = mapObject(node.attributes, function(attribute) {\n            return attribute.value;\n        }, mapName);\n        \n        var element = new Element(mapName(node), attributes);\n        currentElement.children.push(element);\n        stack.push(currentElement);\n        currentElement = element;\n    };\n    \n    function mapName(node) {\n        if (node.uri) {\n            var mappedPrefix = namespaceMap[node.uri];\n            var prefix;\n            if (mappedPrefix) {\n                prefix = mappedPrefix + \":\";\n            } else {\n                prefix = \"{\" + node.uri + \"}\";\n            }\n            return prefix + node.local;\n        } else {\n            return node.local;\n        }\n    }\n    \n    parser.onclosetag = function(node) {\n        currentElement = stack.pop();\n    };\n    \n    parser.ontext = function(text) {\n        if (currentElement !== rootElement) {\n            currentElement.children.push(nodes.text(text));\n        }\n    };\n    \n    parser.onend = function() {\n        if (!finished) {\n            finished = true;\n            deferred.resolve(rootElement.children[0]);\n        }\n    };\n    \n    parser.onerror = function(error) {\n        if (!finished) {\n            finished = true;\n            deferred.reject(error);\n        }\n    };\n    \n    parser.write(xmlString).close();\n    \n    return deferred.promise;\n}\n\nfunction mapObject(input, valueFunc, keyFunc) {\n    return _.reduce(input, function(result, value, key) {\n        var mappedKey = keyFunc(value, key, input);\n        result[mappedKey] = valueFunc(value, key, input);\n        return result;\n    }, {});\n}\n"],"mappings":"AAAA,IAAIA,QAAQ,GAAGC,OAAO,CAAC,aAAD,CAAtB;;AACA,IAAIC,GAAG,GAAGD,OAAO,CAAC,KAAD,CAAjB;;AACA,IAAIE,CAAC,GAAGF,OAAO,CAAC,YAAD,CAAf;;AAEA,IAAIG,KAAK,GAAGH,OAAO,CAAC,SAAD,CAAnB;;AACA,IAAII,OAAO,GAAGD,KAAK,CAACC,OAApB;AAEAC,OAAO,CAACC,UAAR,GAAqBA,UAArB;;AAEA,SAASA,UAAT,CAAoBC,SAApB,EAA+BC,YAA/B,EAA6C;EACzCA,YAAY,GAAGA,YAAY,IAAI,EAA/B;EAEA,IAAIC,QAAQ,GAAG,KAAf;EACA,IAAIC,MAAM,GAAGT,GAAG,CAACS,MAAJ,CAAW,IAAX,EAAiB;IAACC,KAAK,EAAE,IAAR;IAAcC,QAAQ,EAAE;EAAxB,CAAjB,CAAb;EAEA,IAAIC,WAAW,GAAG;IAACC,QAAQ,EAAE;EAAX,CAAlB;EACA,IAAIC,cAAc,GAAGF,WAArB;EACA,IAAIG,KAAK,GAAG,EAAZ;EAEA,IAAIC,QAAQ,GAAGlB,QAAQ,CAACmB,KAAT,EAAf;;EAEAR,MAAM,CAACS,SAAP,GAAmB,UAASC,IAAT,EAAe;IAC9B,IAAIC,UAAU,GAAGC,SAAS,CAACF,IAAI,CAACC,UAAN,EAAkB,UAASE,SAAT,EAAoB;MAC5D,OAAOA,SAAS,CAACC,KAAjB;IACH,CAFyB,EAEvBC,OAFuB,CAA1B;IAIA,IAAIC,OAAO,GAAG,IAAItB,OAAJ,CAAYqB,OAAO,CAACL,IAAD,CAAnB,EAA2BC,UAA3B,CAAd;IACAN,cAAc,CAACD,QAAf,CAAwBa,IAAxB,CAA6BD,OAA7B;IACAV,KAAK,CAACW,IAAN,CAAWZ,cAAX;IACAA,cAAc,GAAGW,OAAjB;EACH,CATD;;EAWA,SAASD,OAAT,CAAiBL,IAAjB,EAAuB;IACnB,IAAIA,IAAI,CAACQ,GAAT,EAAc;MACV,IAAIC,YAAY,GAAGrB,YAAY,CAACY,IAAI,CAACQ,GAAN,CAA/B;MACA,IAAIE,MAAJ;;MACA,IAAID,YAAJ,EAAkB;QACdC,MAAM,GAAGD,YAAY,GAAG,GAAxB;MACH,CAFD,MAEO;QACHC,MAAM,GAAG,MAAMV,IAAI,CAACQ,GAAX,GAAiB,GAA1B;MACH;;MACD,OAAOE,MAAM,GAAGV,IAAI,CAACW,KAArB;IACH,CATD,MASO;MACH,OAAOX,IAAI,CAACW,KAAZ;IACH;EACJ;;EAEDrB,MAAM,CAACsB,UAAP,GAAoB,UAASZ,IAAT,EAAe;IAC/BL,cAAc,GAAGC,KAAK,CAACiB,GAAN,EAAjB;EACH,CAFD;;EAIAvB,MAAM,CAACwB,MAAP,GAAgB,UAASC,IAAT,EAAe;IAC3B,IAAIpB,cAAc,KAAKF,WAAvB,EAAoC;MAChCE,cAAc,CAACD,QAAf,CAAwBa,IAAxB,CAA6BxB,KAAK,CAACgC,IAAN,CAAWA,IAAX,CAA7B;IACH;EACJ,CAJD;;EAMAzB,MAAM,CAAC0B,KAAP,GAAe,YAAW;IACtB,IAAI,CAAC3B,QAAL,EAAe;MACXA,QAAQ,GAAG,IAAX;MACAQ,QAAQ,CAACoB,OAAT,CAAiBxB,WAAW,CAACC,QAAZ,CAAqB,CAArB,CAAjB;IACH;EACJ,CALD;;EAOAJ,MAAM,CAAC4B,OAAP,GAAiB,UAASC,KAAT,EAAgB;IAC7B,IAAI,CAAC9B,QAAL,EAAe;MACXA,QAAQ,GAAG,IAAX;MACAQ,QAAQ,CAACuB,MAAT,CAAgBD,KAAhB;IACH;EACJ,CALD;;EAOA7B,MAAM,CAAC+B,KAAP,CAAalC,SAAb,EAAwBmC,KAAxB;EAEA,OAAOzB,QAAQ,CAAC0B,OAAhB;AACH;;AAED,SAASrB,SAAT,CAAmBsB,KAAnB,EAA0BC,SAA1B,EAAqCC,OAArC,EAA8C;EAC1C,OAAO5C,CAAC,CAAC6C,MAAF,CAASH,KAAT,EAAgB,UAASI,MAAT,EAAiBxB,KAAjB,EAAwByB,GAAxB,EAA6B;IAChD,IAAIC,SAAS,GAAGJ,OAAO,CAACtB,KAAD,EAAQyB,GAAR,EAAaL,KAAb,CAAvB;IACAI,MAAM,CAACE,SAAD,CAAN,GAAoBL,SAAS,CAACrB,KAAD,EAAQyB,GAAR,EAAaL,KAAb,CAA7B;IACA,OAAOI,MAAP;EACH,CAJM,EAIJ,EAJI,CAAP;AAKH"},"metadata":{},"sourceType":"script"}