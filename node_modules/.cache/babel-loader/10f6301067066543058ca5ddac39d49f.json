{"ast":null,"code":"var _ = require(\"underscore\");\n\nvar promises = require(\"./promises\");\n\nvar documents = require(\"./documents\");\n\nvar htmlPaths = require(\"./styles/html-paths\");\n\nvar results = require(\"./results\");\n\nvar images = require(\"./images\");\n\nvar Html = require(\"./html\");\n\nvar writers = require(\"./writers\");\n\nexports.DocumentConverter = DocumentConverter;\n\nfunction DocumentConverter(options) {\n  return {\n    convertToHtml: function (element) {\n      var comments = _.indexBy(element.type === documents.types.document ? element.comments : [], \"commentId\");\n\n      var conversion = new DocumentConversion(options, comments);\n      return conversion.convertToHtml(element);\n    }\n  };\n}\n\nfunction DocumentConversion(options, comments) {\n  var noteNumber = 1;\n  var noteReferences = [];\n  var referencedComments = [];\n  options = _.extend({\n    ignoreEmptyParagraphs: true\n  }, options);\n  var idPrefix = options.idPrefix === undefined ? \"\" : options.idPrefix;\n  var ignoreEmptyParagraphs = options.ignoreEmptyParagraphs;\n  var defaultParagraphStyle = htmlPaths.topLevelElement(\"p\");\n  var styleMap = options.styleMap || [];\n\n  function convertToHtml(document) {\n    var messages = [];\n    var html = elementToHtml(document, messages, {});\n    var deferredNodes = [];\n    walkHtml(html, function (node) {\n      if (node.type === \"deferred\") {\n        deferredNodes.push(node);\n      }\n    });\n    var deferredValues = {};\n    return promises.mapSeries(deferredNodes, function (deferred) {\n      return deferred.value().then(function (value) {\n        deferredValues[deferred.id] = value;\n      });\n    }).then(function () {\n      function replaceDeferred(nodes) {\n        return flatMap(nodes, function (node) {\n          if (node.type === \"deferred\") {\n            return deferredValues[node.id];\n          } else if (node.children) {\n            return [_.extend({}, node, {\n              children: replaceDeferred(node.children)\n            })];\n          } else {\n            return [node];\n          }\n        });\n      }\n\n      var writer = writers.writer({\n        prettyPrint: options.prettyPrint,\n        outputFormat: options.outputFormat\n      });\n      Html.write(writer, Html.simplify(replaceDeferred(html)));\n      return new results.Result(writer.asString(), messages);\n    });\n  }\n\n  function convertElements(elements, messages, options) {\n    return flatMap(elements, function (element) {\n      return elementToHtml(element, messages, options);\n    });\n  }\n\n  function elementToHtml(element, messages, options) {\n    if (!options) {\n      throw new Error(\"options not set\");\n    }\n\n    var handler = elementConverters[element.type];\n\n    if (handler) {\n      return handler(element, messages, options);\n    } else {\n      return [];\n    }\n  }\n\n  function convertParagraph(element, messages, options) {\n    return htmlPathForParagraph(element, messages).wrap(function () {\n      var content = convertElements(element.children, messages, options);\n\n      if (ignoreEmptyParagraphs) {\n        return content;\n      } else {\n        return [Html.forceWrite].concat(content);\n      }\n    });\n  }\n\n  function htmlPathForParagraph(element, messages) {\n    var style = findStyle(element);\n\n    if (style) {\n      return style.to;\n    } else {\n      if (element.styleId) {\n        messages.push(unrecognisedStyleWarning(\"paragraph\", element));\n      }\n\n      return defaultParagraphStyle;\n    }\n  }\n\n  function convertRun(run, messages, options) {\n    var nodes = function () {\n      return convertElements(run.children, messages, options);\n    };\n\n    var paths = [];\n\n    if (run.isSmallCaps) {\n      paths.push(findHtmlPathForRunProperty(\"smallCaps\"));\n    }\n\n    if (run.isAllCaps) {\n      paths.push(findHtmlPathForRunProperty(\"allCaps\"));\n    }\n\n    if (run.isStrikethrough) {\n      paths.push(findHtmlPathForRunProperty(\"strikethrough\", \"s\"));\n    }\n\n    if (run.isUnderline) {\n      paths.push(findHtmlPathForRunProperty(\"underline\"));\n    }\n\n    if (run.verticalAlignment === documents.verticalAlignment.subscript) {\n      paths.push(htmlPaths.element(\"sub\", {}, {\n        fresh: false\n      }));\n    }\n\n    if (run.verticalAlignment === documents.verticalAlignment.superscript) {\n      paths.push(htmlPaths.element(\"sup\", {}, {\n        fresh: false\n      }));\n    }\n\n    if (run.isItalic) {\n      paths.push(findHtmlPathForRunProperty(\"italic\", \"em\"));\n    }\n\n    if (run.isBold) {\n      paths.push(findHtmlPathForRunProperty(\"bold\", \"strong\"));\n    }\n\n    var stylePath = htmlPaths.empty;\n    var style = findStyle(run);\n\n    if (style) {\n      stylePath = style.to;\n    } else if (run.styleId) {\n      messages.push(unrecognisedStyleWarning(\"run\", run));\n    }\n\n    paths.push(stylePath);\n    paths.forEach(function (path) {\n      nodes = path.wrap.bind(path, nodes);\n    });\n    return nodes();\n  }\n\n  function findHtmlPathForRunProperty(elementType, defaultTagName) {\n    var path = findHtmlPath({\n      type: elementType\n    });\n\n    if (path) {\n      return path;\n    } else if (defaultTagName) {\n      return htmlPaths.element(defaultTagName, {}, {\n        fresh: false\n      });\n    } else {\n      return htmlPaths.empty;\n    }\n  }\n\n  function findHtmlPath(element, defaultPath) {\n    var style = findStyle(element);\n    return style ? style.to : defaultPath;\n  }\n\n  function findStyle(element) {\n    for (var i = 0; i < styleMap.length; i++) {\n      if (styleMap[i].from.matches(element)) {\n        return styleMap[i];\n      }\n    }\n  }\n\n  function recoveringConvertImage(convertImage) {\n    return function (image, messages) {\n      return promises.attempt(function () {\n        return convertImage(image, messages);\n      }).caught(function (error) {\n        messages.push(results.error(error));\n        return [];\n      });\n    };\n  }\n\n  function noteHtmlId(note) {\n    return referentHtmlId(note.noteType, note.noteId);\n  }\n\n  function noteRefHtmlId(note) {\n    return referenceHtmlId(note.noteType, note.noteId);\n  }\n\n  function referentHtmlId(referenceType, referenceId) {\n    return htmlId(referenceType + \"-\" + referenceId);\n  }\n\n  function referenceHtmlId(referenceType, referenceId) {\n    return htmlId(referenceType + \"-ref-\" + referenceId);\n  }\n\n  function htmlId(suffix) {\n    return idPrefix + suffix;\n  }\n\n  var defaultTablePath = htmlPaths.elements([htmlPaths.element(\"table\", {}, {\n    fresh: true\n  })]);\n\n  function convertTable(element, messages, options) {\n    return findHtmlPath(element, defaultTablePath).wrap(function () {\n      return convertTableChildren(element, messages, options);\n    });\n  }\n\n  function convertTableChildren(element, messages, options) {\n    var bodyIndex = _.findIndex(element.children, function (child) {\n      return !child.type === documents.types.tableRow || !child.isHeader;\n    });\n\n    if (bodyIndex === -1) {\n      bodyIndex = element.children.length;\n    }\n\n    var children;\n\n    if (bodyIndex === 0) {\n      children = convertElements(element.children, messages, _.extend({}, options, {\n        isTableHeader: false\n      }));\n    } else {\n      var headRows = convertElements(element.children.slice(0, bodyIndex), messages, _.extend({}, options, {\n        isTableHeader: true\n      }));\n      var bodyRows = convertElements(element.children.slice(bodyIndex), messages, _.extend({}, options, {\n        isTableHeader: false\n      }));\n      children = [Html.freshElement(\"thead\", {}, headRows), Html.freshElement(\"tbody\", {}, bodyRows)];\n    }\n\n    return [Html.forceWrite].concat(children);\n  }\n\n  function convertTableRow(element, messages, options) {\n    var children = convertElements(element.children, messages, options);\n    return [Html.freshElement(\"tr\", {}, [Html.forceWrite].concat(children))];\n  }\n\n  function convertTableCell(element, messages, options) {\n    var tagName = options.isTableHeader ? \"th\" : \"td\";\n    var children = convertElements(element.children, messages, options);\n    var attributes = {};\n\n    if (element.colSpan !== 1) {\n      attributes.colspan = element.colSpan.toString();\n    }\n\n    if (element.rowSpan !== 1) {\n      attributes.rowspan = element.rowSpan.toString();\n    }\n\n    return [Html.freshElement(tagName, attributes, [Html.forceWrite].concat(children))];\n  }\n\n  function convertCommentReference(reference, messages, options) {\n    return findHtmlPath(reference, htmlPaths.ignore).wrap(function () {\n      var comment = comments[reference.commentId];\n      var count = referencedComments.length + 1;\n      var label = \"[\" + commentAuthorLabel(comment) + count + \"]\";\n      referencedComments.push({\n        label: label,\n        comment: comment\n      }); // TODO: remove duplication with note references\n\n      return [Html.freshElement(\"a\", {\n        href: \"#\" + referentHtmlId(\"comment\", reference.commentId),\n        id: referenceHtmlId(\"comment\", reference.commentId)\n      }, [Html.text(label)])];\n    });\n  }\n\n  function convertComment(referencedComment, messages, options) {\n    // TODO: remove duplication with note references\n    var label = referencedComment.label;\n    var comment = referencedComment.comment;\n    var body = convertElements(comment.body, messages, options).concat([Html.nonFreshElement(\"p\", {}, [Html.text(\" \"), Html.freshElement(\"a\", {\n      \"href\": \"#\" + referenceHtmlId(\"comment\", comment.commentId)\n    }, [Html.text(\"↑\")])])]);\n    return [Html.freshElement(\"dt\", {\n      \"id\": referentHtmlId(\"comment\", comment.commentId)\n    }, [Html.text(\"Comment \" + label)]), Html.freshElement(\"dd\", {}, body)];\n  }\n\n  function convertBreak(element, messages, options) {\n    return htmlPathForBreak(element).wrap(function () {\n      return [];\n    });\n  }\n\n  function htmlPathForBreak(element) {\n    var style = findStyle(element);\n\n    if (style) {\n      return style.to;\n    } else if (element.breakType === \"line\") {\n      return htmlPaths.topLevelElement(\"br\");\n    } else {\n      return htmlPaths.empty;\n    }\n  }\n\n  var elementConverters = {\n    \"document\": function (document, messages, options) {\n      var children = convertElements(document.children, messages, options);\n      var notes = noteReferences.map(function (noteReference) {\n        return document.notes.resolve(noteReference);\n      });\n      var notesNodes = convertElements(notes, messages, options);\n      return children.concat([Html.freshElement(\"ol\", {}, notesNodes), Html.freshElement(\"dl\", {}, flatMap(referencedComments, function (referencedComment) {\n        return convertComment(referencedComment, messages, options);\n      }))]);\n    },\n    \"paragraph\": convertParagraph,\n    \"run\": convertRun,\n    \"text\": function (element, messages, options) {\n      return [Html.text(element.value)];\n    },\n    \"tab\": function (element, messages, options) {\n      return [Html.text(\"\\t\")];\n    },\n    \"hyperlink\": function (element, messages, options) {\n      var href = element.anchor ? \"#\" + htmlId(element.anchor) : element.href;\n      var attributes = {\n        href: href\n      };\n\n      if (element.targetFrame != null) {\n        attributes.target = element.targetFrame;\n      }\n\n      var children = convertElements(element.children, messages, options);\n      return [Html.nonFreshElement(\"a\", attributes, children)];\n    },\n    \"bookmarkStart\": function (element, messages, options) {\n      var anchor = Html.freshElement(\"a\", {\n        id: htmlId(element.name)\n      }, [Html.forceWrite]);\n      return [anchor];\n    },\n    \"noteReference\": function (element, messages, options) {\n      noteReferences.push(element);\n      var anchor = Html.freshElement(\"a\", {\n        href: \"#\" + noteHtmlId(element),\n        id: noteRefHtmlId(element)\n      }, [Html.text(\"[\" + noteNumber++ + \"]\")]);\n      return [Html.freshElement(\"sup\", {}, [anchor])];\n    },\n    \"note\": function (element, messages, options) {\n      var children = convertElements(element.body, messages, options);\n      var backLink = Html.elementWithTag(htmlPaths.element(\"p\", {}, {\n        fresh: false\n      }), [Html.text(\" \"), Html.freshElement(\"a\", {\n        href: \"#\" + noteRefHtmlId(element)\n      }, [Html.text(\"↑\")])]);\n      var body = children.concat([backLink]);\n      return Html.freshElement(\"li\", {\n        id: noteHtmlId(element)\n      }, body);\n    },\n    \"commentReference\": convertCommentReference,\n    \"comment\": convertComment,\n    \"image\": deferredConversion(recoveringConvertImage(options.convertImage || images.dataUri)),\n    \"table\": convertTable,\n    \"tableRow\": convertTableRow,\n    \"tableCell\": convertTableCell,\n    \"break\": convertBreak\n  };\n  return {\n    convertToHtml: convertToHtml\n  };\n}\n\nvar deferredId = 1;\n\nfunction deferredConversion(func) {\n  return function (element, messages, options) {\n    return [{\n      type: \"deferred\",\n      id: deferredId++,\n      value: function () {\n        return func(element, messages, options);\n      }\n    }];\n  };\n}\n\nfunction unrecognisedStyleWarning(type, element) {\n  return results.warning(\"Unrecognised \" + type + \" style: '\" + element.styleName + \"'\" + \" (Style ID: \" + element.styleId + \")\");\n}\n\nfunction flatMap(values, func) {\n  return _.flatten(values.map(func), true);\n}\n\nfunction walkHtml(nodes, callback) {\n  nodes.forEach(function (node) {\n    callback(node);\n\n    if (node.children) {\n      walkHtml(node.children, callback);\n    }\n  });\n}\n\nvar commentAuthorLabel = exports.commentAuthorLabel = function commentAuthorLabel(comment) {\n  return comment.authorInitials || \"\";\n};","map":{"version":3,"names":["_","require","promises","documents","htmlPaths","results","images","Html","writers","exports","DocumentConverter","options","convertToHtml","element","comments","indexBy","type","types","document","conversion","DocumentConversion","noteNumber","noteReferences","referencedComments","extend","ignoreEmptyParagraphs","idPrefix","undefined","defaultParagraphStyle","topLevelElement","styleMap","messages","html","elementToHtml","deferredNodes","walkHtml","node","push","deferredValues","mapSeries","deferred","value","then","id","replaceDeferred","nodes","flatMap","children","writer","prettyPrint","outputFormat","write","simplify","Result","asString","convertElements","elements","Error","handler","elementConverters","convertParagraph","htmlPathForParagraph","wrap","content","forceWrite","concat","style","findStyle","to","styleId","unrecognisedStyleWarning","convertRun","run","paths","isSmallCaps","findHtmlPathForRunProperty","isAllCaps","isStrikethrough","isUnderline","verticalAlignment","subscript","fresh","superscript","isItalic","isBold","stylePath","empty","forEach","path","bind","elementType","defaultTagName","findHtmlPath","defaultPath","i","length","from","matches","recoveringConvertImage","convertImage","image","attempt","caught","error","noteHtmlId","note","referentHtmlId","noteType","noteId","noteRefHtmlId","referenceHtmlId","referenceType","referenceId","htmlId","suffix","defaultTablePath","convertTable","convertTableChildren","bodyIndex","findIndex","child","tableRow","isHeader","isTableHeader","headRows","slice","bodyRows","freshElement","convertTableRow","convertTableCell","tagName","attributes","colSpan","colspan","toString","rowSpan","rowspan","convertCommentReference","reference","ignore","comment","commentId","count","label","commentAuthorLabel","href","text","convertComment","referencedComment","body","nonFreshElement","convertBreak","htmlPathForBreak","breakType","notes","map","noteReference","resolve","notesNodes","anchor","targetFrame","target","name","backLink","elementWithTag","deferredConversion","dataUri","deferredId","func","warning","styleName","values","flatten","callback","authorInitials"],"sources":["E:/react-projects/new project/2022/converter/converter/node_modules/mammoth/lib/document-to-html.js"],"sourcesContent":["var _ = require(\"underscore\");\n\nvar promises = require(\"./promises\");\nvar documents = require(\"./documents\");\nvar htmlPaths = require(\"./styles/html-paths\");\nvar results = require(\"./results\");\nvar images = require(\"./images\");\nvar Html = require(\"./html\");\nvar writers = require(\"./writers\");\n\nexports.DocumentConverter = DocumentConverter;\n\n\nfunction DocumentConverter(options) {\n    return {\n        convertToHtml: function(element) {\n            var comments = _.indexBy(\n                element.type === documents.types.document ? element.comments : [],\n                \"commentId\"\n            );\n            var conversion = new DocumentConversion(options, comments);\n            return conversion.convertToHtml(element);\n        }\n    };\n}\n\nfunction DocumentConversion(options, comments) {\n    var noteNumber = 1;\n\n    var noteReferences = [];\n\n    var referencedComments = [];\n\n    options = _.extend({ignoreEmptyParagraphs: true}, options);\n    var idPrefix = options.idPrefix === undefined ? \"\" : options.idPrefix;\n    var ignoreEmptyParagraphs = options.ignoreEmptyParagraphs;\n\n    var defaultParagraphStyle = htmlPaths.topLevelElement(\"p\");\n\n    var styleMap = options.styleMap || [];\n\n    function convertToHtml(document) {\n        var messages = [];\n\n        var html = elementToHtml(document, messages, {});\n\n        var deferredNodes = [];\n        walkHtml(html, function(node) {\n            if (node.type === \"deferred\") {\n                deferredNodes.push(node);\n            }\n        });\n        var deferredValues = {};\n        return promises.mapSeries(deferredNodes, function(deferred) {\n            return deferred.value().then(function(value) {\n                deferredValues[deferred.id] = value;\n            });\n        }).then(function() {\n            function replaceDeferred(nodes) {\n                return flatMap(nodes, function(node) {\n                    if (node.type === \"deferred\") {\n                        return deferredValues[node.id];\n                    } else if (node.children) {\n                        return [\n                            _.extend({}, node, {\n                                children: replaceDeferred(node.children)\n                            })\n                        ];\n                    } else {\n                        return [node];\n                    }\n                });\n            }\n            var writer = writers.writer({\n                prettyPrint: options.prettyPrint,\n                outputFormat: options.outputFormat\n            });\n            Html.write(writer, Html.simplify(replaceDeferred(html)));\n            return new results.Result(writer.asString(), messages);\n        });\n    }\n\n    function convertElements(elements, messages, options) {\n        return flatMap(elements, function(element) {\n            return elementToHtml(element, messages, options);\n        });\n    }\n\n    function elementToHtml(element, messages, options) {\n        if (!options) {\n            throw new Error(\"options not set\");\n        }\n        var handler = elementConverters[element.type];\n        if (handler) {\n            return handler(element, messages, options);\n        } else {\n            return [];\n        }\n    }\n\n    function convertParagraph(element, messages, options) {\n        return htmlPathForParagraph(element, messages).wrap(function() {\n            var content = convertElements(element.children, messages, options);\n            if (ignoreEmptyParagraphs) {\n                return content;\n            } else {\n                return [Html.forceWrite].concat(content);\n            }\n        });\n    }\n\n    function htmlPathForParagraph(element, messages) {\n        var style = findStyle(element);\n\n        if (style) {\n            return style.to;\n        } else {\n            if (element.styleId) {\n                messages.push(unrecognisedStyleWarning(\"paragraph\", element));\n            }\n            return defaultParagraphStyle;\n        }\n    }\n\n    function convertRun(run, messages, options) {\n        var nodes = function() {\n            return convertElements(run.children, messages, options);\n        };\n        var paths = [];\n        if (run.isSmallCaps) {\n            paths.push(findHtmlPathForRunProperty(\"smallCaps\"));\n        }\n        if (run.isAllCaps) {\n            paths.push(findHtmlPathForRunProperty(\"allCaps\"));\n        }\n        if (run.isStrikethrough) {\n            paths.push(findHtmlPathForRunProperty(\"strikethrough\", \"s\"));\n        }\n        if (run.isUnderline) {\n            paths.push(findHtmlPathForRunProperty(\"underline\"));\n        }\n        if (run.verticalAlignment === documents.verticalAlignment.subscript) {\n            paths.push(htmlPaths.element(\"sub\", {}, {fresh: false}));\n        }\n        if (run.verticalAlignment === documents.verticalAlignment.superscript) {\n            paths.push(htmlPaths.element(\"sup\", {}, {fresh: false}));\n        }\n        if (run.isItalic) {\n            paths.push(findHtmlPathForRunProperty(\"italic\", \"em\"));\n        }\n        if (run.isBold) {\n            paths.push(findHtmlPathForRunProperty(\"bold\", \"strong\"));\n        }\n        var stylePath = htmlPaths.empty;\n        var style = findStyle(run);\n        if (style) {\n            stylePath = style.to;\n        } else if (run.styleId) {\n            messages.push(unrecognisedStyleWarning(\"run\", run));\n        }\n        paths.push(stylePath);\n\n        paths.forEach(function(path) {\n            nodes = path.wrap.bind(path, nodes);\n        });\n\n        return nodes();\n    }\n\n    function findHtmlPathForRunProperty(elementType, defaultTagName) {\n        var path = findHtmlPath({type: elementType});\n        if (path) {\n            return path;\n        } else if (defaultTagName) {\n            return htmlPaths.element(defaultTagName, {}, {fresh: false});\n        } else {\n            return htmlPaths.empty;\n        }\n    }\n\n    function findHtmlPath(element, defaultPath) {\n        var style = findStyle(element);\n        return style ? style.to : defaultPath;\n    }\n\n    function findStyle(element) {\n        for (var i = 0; i < styleMap.length; i++) {\n            if (styleMap[i].from.matches(element)) {\n                return styleMap[i];\n            }\n        }\n    }\n\n    function recoveringConvertImage(convertImage) {\n        return function(image, messages) {\n            return promises.attempt(function() {\n                return convertImage(image, messages);\n            }).caught(function(error) {\n                messages.push(results.error(error));\n                return [];\n            });\n        };\n    }\n\n    function noteHtmlId(note) {\n        return referentHtmlId(note.noteType, note.noteId);\n    }\n\n    function noteRefHtmlId(note) {\n        return referenceHtmlId(note.noteType, note.noteId);\n    }\n\n    function referentHtmlId(referenceType, referenceId) {\n        return htmlId(referenceType + \"-\" + referenceId);\n    }\n\n    function referenceHtmlId(referenceType, referenceId) {\n        return htmlId(referenceType + \"-ref-\" + referenceId);\n    }\n\n    function htmlId(suffix) {\n        return idPrefix + suffix;\n    }\n\n    var defaultTablePath = htmlPaths.elements([\n        htmlPaths.element(\"table\", {}, {fresh: true})\n    ]);\n\n    function convertTable(element, messages, options) {\n        return findHtmlPath(element, defaultTablePath).wrap(function() {\n            return convertTableChildren(element, messages, options);\n        });\n    }\n\n    function convertTableChildren(element, messages, options) {\n        var bodyIndex = _.findIndex(element.children, function(child) {\n            return !child.type === documents.types.tableRow || !child.isHeader;\n        });\n        if (bodyIndex === -1) {\n            bodyIndex = element.children.length;\n        }\n        var children;\n        if (bodyIndex === 0) {\n            children = convertElements(\n                element.children,\n                messages,\n                _.extend({}, options, {isTableHeader: false})\n            );\n        } else {\n            var headRows = convertElements(\n                element.children.slice(0, bodyIndex),\n                messages,\n                _.extend({}, options, {isTableHeader: true})\n            );\n            var bodyRows = convertElements(\n                element.children.slice(bodyIndex),\n                messages,\n                _.extend({}, options, {isTableHeader: false})\n            );\n            children = [\n                Html.freshElement(\"thead\", {}, headRows),\n                Html.freshElement(\"tbody\", {}, bodyRows)\n            ];\n        }\n        return [Html.forceWrite].concat(children);\n    }\n\n    function convertTableRow(element, messages, options) {\n        var children = convertElements(element.children, messages, options);\n        return [\n            Html.freshElement(\"tr\", {}, [Html.forceWrite].concat(children))\n        ];\n    }\n\n    function convertTableCell(element, messages, options) {\n        var tagName = options.isTableHeader ? \"th\" : \"td\";\n        var children = convertElements(element.children, messages, options);\n        var attributes = {};\n        if (element.colSpan !== 1) {\n            attributes.colspan = element.colSpan.toString();\n        }\n        if (element.rowSpan !== 1) {\n            attributes.rowspan = element.rowSpan.toString();\n        }\n\n        return [\n            Html.freshElement(tagName, attributes, [Html.forceWrite].concat(children))\n        ];\n    }\n\n    function convertCommentReference(reference, messages, options) {\n        return findHtmlPath(reference, htmlPaths.ignore).wrap(function() {\n            var comment = comments[reference.commentId];\n            var count = referencedComments.length + 1;\n            var label = \"[\" + commentAuthorLabel(comment) + count + \"]\";\n            referencedComments.push({label: label, comment: comment});\n            // TODO: remove duplication with note references\n            return [\n                Html.freshElement(\"a\", {\n                    href: \"#\" + referentHtmlId(\"comment\", reference.commentId),\n                    id: referenceHtmlId(\"comment\", reference.commentId)\n                }, [Html.text(label)])\n            ];\n        });\n    }\n\n    function convertComment(referencedComment, messages, options) {\n        // TODO: remove duplication with note references\n\n        var label = referencedComment.label;\n        var comment = referencedComment.comment;\n        var body = convertElements(comment.body, messages, options).concat([\n            Html.nonFreshElement(\"p\", {}, [\n                Html.text(\" \"),\n                Html.freshElement(\"a\", {\"href\": \"#\" + referenceHtmlId(\"comment\", comment.commentId)}, [\n                    Html.text(\"↑\")\n                ])\n            ])\n        ]);\n\n        return [\n            Html.freshElement(\n                \"dt\",\n                {\"id\": referentHtmlId(\"comment\", comment.commentId)},\n                [Html.text(\"Comment \" + label)]\n            ),\n            Html.freshElement(\"dd\", {}, body)\n        ];\n    }\n\n    function convertBreak(element, messages, options) {\n        return htmlPathForBreak(element).wrap(function() {\n            return [];\n        });\n    }\n\n    function htmlPathForBreak(element) {\n        var style = findStyle(element);\n        if (style) {\n            return style.to;\n        } else if (element.breakType === \"line\") {\n            return htmlPaths.topLevelElement(\"br\");\n        } else {\n            return htmlPaths.empty;\n        }\n    }\n\n    var elementConverters = {\n        \"document\": function(document, messages, options) {\n            var children = convertElements(document.children, messages, options);\n            var notes = noteReferences.map(function(noteReference) {\n                return document.notes.resolve(noteReference);\n            });\n            var notesNodes = convertElements(notes, messages, options);\n            return children.concat([\n                Html.freshElement(\"ol\", {}, notesNodes),\n                Html.freshElement(\"dl\", {}, flatMap(referencedComments, function(referencedComment) {\n                    return convertComment(referencedComment, messages, options);\n                }))\n            ]);\n        },\n        \"paragraph\": convertParagraph,\n        \"run\": convertRun,\n        \"text\": function(element, messages, options) {\n            return [Html.text(element.value)];\n        },\n        \"tab\": function(element, messages, options) {\n            return [Html.text(\"\\t\")];\n        },\n        \"hyperlink\": function(element, messages, options) {\n            var href = element.anchor ? \"#\" + htmlId(element.anchor) : element.href;\n            var attributes = {href: href};\n            if (element.targetFrame != null) {\n                attributes.target = element.targetFrame;\n            }\n\n            var children = convertElements(element.children, messages, options);\n            return [Html.nonFreshElement(\"a\", attributes, children)];\n        },\n        \"bookmarkStart\": function(element, messages, options) {\n            var anchor = Html.freshElement(\"a\", {\n                id: htmlId(element.name)\n            }, [Html.forceWrite]);\n            return [anchor];\n        },\n        \"noteReference\": function(element, messages, options) {\n            noteReferences.push(element);\n            var anchor = Html.freshElement(\"a\", {\n                href: \"#\" + noteHtmlId(element),\n                id: noteRefHtmlId(element)\n            }, [Html.text(\"[\" + (noteNumber++) + \"]\")]);\n\n            return [Html.freshElement(\"sup\", {}, [anchor])];\n        },\n        \"note\": function(element, messages, options) {\n            var children = convertElements(element.body, messages, options);\n            var backLink = Html.elementWithTag(htmlPaths.element(\"p\", {}, {fresh: false}), [\n                Html.text(\" \"),\n                Html.freshElement(\"a\", {href: \"#\" + noteRefHtmlId(element)}, [Html.text(\"↑\")])\n            ]);\n            var body = children.concat([backLink]);\n\n            return Html.freshElement(\"li\", {id: noteHtmlId(element)}, body);\n        },\n        \"commentReference\": convertCommentReference,\n        \"comment\": convertComment,\n        \"image\": deferredConversion(recoveringConvertImage(options.convertImage || images.dataUri)),\n        \"table\": convertTable,\n        \"tableRow\": convertTableRow,\n        \"tableCell\": convertTableCell,\n        \"break\": convertBreak\n    };\n    return {\n        convertToHtml: convertToHtml\n    };\n}\n\nvar deferredId = 1;\n\nfunction deferredConversion(func) {\n    return function(element, messages, options) {\n        return [\n            {\n                type: \"deferred\",\n                id: deferredId++,\n                value: function() {\n                    return func(element, messages, options);\n                }\n            }\n        ];\n    };\n}\n\nfunction unrecognisedStyleWarning(type, element) {\n    return results.warning(\n        \"Unrecognised \" + type + \" style: '\" + element.styleName + \"'\" +\n        \" (Style ID: \" + element.styleId + \")\"\n    );\n}\n\nfunction flatMap(values, func) {\n    return _.flatten(values.map(func), true);\n}\n\nfunction walkHtml(nodes, callback) {\n    nodes.forEach(function(node) {\n        callback(node);\n        if (node.children) {\n            walkHtml(node.children, callback);\n        }\n    });\n}\n\nvar commentAuthorLabel = exports.commentAuthorLabel = function commentAuthorLabel(comment) {\n    return comment.authorInitials || \"\";\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}